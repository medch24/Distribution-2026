<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Distribution Annuelle 2025-2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.6/dist/pizzip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.47.1/docxtemplater.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- La ligne pour socket.io.js a √©t√© supprim√©e d'ici -->
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="white"/><path d="M16 96l112-40 112 40-112 40z" fill="%232563eb"/><path d="M64 120v48c0 22 48 40 64 40s64-18 64-40v-48" fill="none" stroke="%233b82f6" stroke-width="12"/></svg>' type="image/svg+xml">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body>
<div id="initialSelection">
    <div style="text-align: center; margin-bottom: 20px;">
        <img src="logo-ecole.png" alt="Logo de l'√©cole" style="max-width: 200px; height: auto; margin-bottom: 10px;">
    </div>
    <h1>Distribution Annuelle 2025-2026</h1>
    <button onclick="showClasses('maternelle')">Section Maternelle</button>
    <button onclick="showClasses('primaire')">Section Primaire</button>
    <button onclick="showClasses('secondaire')">Section Secondaire (PEI et P. Dipl√¥me)</button>
    <div id="maternelle" class="section-classes">
        <button onclick="goToClass('TPS')">TPS</button><button onclick="goToClass('PS')">PS</button><button onclick="goToClass('MS')">MS</button><button onclick="goToClass('GS')">GS</button>
    </div>
    <div id="primaire" class="section-classes">
        <button onclick="goToClass('PP1')">PP1</button><button onclick="goToClass('PP2')">PP2</button><button onclick="goToClass('PP3')">PP3</button><button onclick="goToClass('PP4')">PP4</button><button onclick="goToClass('PP5')">PP5</button>
    </div>
    <div id="secondaire" class="section-classes">
        <button onclick="goToClass('PEI1')">PEI1</button><button onclick="goToClass('PEI2')">PEI2</button><button onclick="goToClass('PEI3')">PEI3</button><button onclick="goToClass('PEI4')">PEI4</button><button onclick="goToClass('PEI5')">PEI5</button><button onclick="goToClass('DP1')">DP1</button><button onclick="goToClass('DP2')">DP2</button>
    </div>
</div>
<div id="classView" style="display: none;" class="card accent">
    <div style="text-align: center; margin-bottom: 15px;">
        <img src="logo-ecole.png" alt="Logo de l'√©cole" style="max-width: 150px; height: auto;">
    </div>
    <h1 id="classTitle"></h1>
    <button onclick="showInitialSelection()" class="secondary"><i class="ri-arrow-go-back-line"></i> Changer de Classe</button>
    
    <!-- Section Distribution Automatique (Gar√ßons) - Visible uniquement pour PEI1-4 et DP2 -->
    <div id="aiDistributionSection" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; margin: 20px 0; color: white;">
        <h3 style="margin-top: 0; color: white;"><i class="ri-magic-line"></i> Distribution Automatique IA (Gar√ßons)</h3>
        <p style="font-size: 14px; margin-bottom: 15px;">Ins√©rez le sommaire du livre manuel et du cahier d'activit√© pour g√©n√©rer automatiquement la distribution en respectant le calendrier.</p>
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">üìñ Sommaire du Livre Manuel:</label>
            <textarea id="manuelSummary" rows="6" style="width: 100%; padding: 10px; border-radius: 5px; border: none; font-size: 13px;" placeholder="Ex: Chapitre 1: Introduction √† l'alg√®bre..."></textarea>
        </div>
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">üìù Sommaire du Cahier d'Activit√©:</label>
            <textarea id="cahierSummary" rows="6" style="width: 100%; padding: 10px; border-radius: 5px; border: none; font-size: 13px;" placeholder="Ex: Exercice 1: R√©soudre des √©quations..."></textarea>
        </div>
        <button onclick="generateAIDistribution()" style="background: #fbbf24; color: #1f2937; padding: 12px 25px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 15px;">
            <i class="ri-sparkles-line"></i> G√©n√©rer Distribution Automatique
        </button>
    </div>
    
    <div class="button-container" style="margin-bottom: 20px; margin-top: 10px;">
        <button onclick="generateExcel()" class="primary"><i class="ri-file-excel-2-line"></i> G√©n√©rer Excel (Mati√®re)</button>
        <button onclick="generateWord()" class="primary"><i class="ri-file-word-2-line"></i> G√©n√©rer Word (Mati√®re)</button>
        <button onclick="generateExcelZipForClass()" class="secondary"><i class="ri-archive-2-line"></i> Excel (ZIP par Classe)</button>
        <button onclick="generateWordZipForClass()" class="secondary"><i class="ri-archive-stack-line"></i> Word (ZIP par Classe)</button>
        <button onclick="saveTable()" class="primary"><i class="ri-save-3-line"></i> Enregistrer</button>
        <button onclick="resetCurrentMatiere()" class="danger"><i class="ri-refresh-line"></i> R√©initialiser la mati√®re</button>
        <button onclick="document.getElementById('excelUploadInput').click()" class="info"><i class="ri-upload-2-line"></i> Importer Excel</button>
        <input type="file" id="excelUploadInput" style="display: none;" onchange="handleFileUpload(event)" accept=".xlsx, .xls">
        <button onclick="document.getElementById('docxUploadInput').click()" class="info"><i class="ri-brain-line"></i> Importer Word (IA)</button>
        <input type="file" id="docxUploadInput" style="display: none;" onchange="handleDocxImport(event)" accept=".docx">
    </div>
    <div>
        <label for="matiereSelect">Choisir une mati√®re :</label>
        <select id="matiereSelect" onchange="displaySelectedTable()"><option value="">S√©lectionner une mati√®re</option></select>
    </div>
    <div style="margin-top: 20px;">
        <label for="filterBy">Filtrer par :</label>
        <select id="filterBy" onchange="populateFilterOptions()">
            <option value="">S√©lectionner un filtre</option>
            <option value="Mois">Mois</option>
            <option value="Semaine">Semaine</option>
        </select>
        <select id="filterOptions" onchange="applyFilter()" style="display: none;"></select>
        <button onclick="clearFilter()" class="warning"><i class="ri-filter-off-line"></i> Annuler le filtre</button>
        <label style="margin-left: 20px;"><input type="checkbox" id="showFilledOnly" onclick="toggleFilledRows()"> Afficher uniquement les lignes remplies</label>
    </div>
    <div id="progressBar"><div></div></div>
    <div id="presenceBar"></div>
    <div class="table-container accent">
        <div id="output"></div>
    </div>
</div>

<script defer src="script.js"></script>
</body>
</html>
